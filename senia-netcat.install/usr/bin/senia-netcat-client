#!/bin/bash

# This script is licensed under GPL v3 or higher.

# Author: Angel Berlanas Vicente
#         <angel.berlanas@gmail.com>

# Some values
SNHOSTNAME=$(hostname)

if [ $# -lt 3 ]; then
	echo " * USAGE : $(basename $0) IP PORT MSG "
	exit 1
fi

IP=$1
PORT=$2
shift 2

TUNEL="[ direct ]"

LINE=$(ss -l -p| grep $PORT |head -n 1)

rc=0

echo $LINE|grep -q ssh||rc=1
if [ $rc -eq 0 ]; then
	TUNEL="[ tunneled ]"
fi
	
echo " - $(date +%Y/%m/%d-%H:%M) [ $SNHOSTNAME ] $TUNEL > $@" | nc -q 1 $IP $PORT


exit 0
